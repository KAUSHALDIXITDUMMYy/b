<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fliff Admin Dashboard</title>
  <style>
    :root {
      --bg-primary: #0a0a14;
      --bg-secondary: #12122a;
      --bg-card: #1a1a3e;
      --accent: #6366f1;
      --accent-green: #22c55e;
      --accent-red: #ef4444;
      --accent-yellow: #eab308;
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--accent);
    }
    
    .back-link {
      color: var(--text-secondary);
      text-decoration: none;
      padding: 8px 16px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
    }
    
    .back-link:hover {
      background: var(--bg-card);
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-value.green { color: var(--accent-green); }
    .stat-value.red { color: var(--accent-red); }
    .stat-value.yellow { color: var(--accent-yellow); }
    .stat-value.blue { color: var(--accent); }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      text-transform: uppercase;
    }
    
    /* Charts Section */
    .charts-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-card {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 12px;
    }
    
    .chart-title {
      font-size: 16px;
      margin-bottom: 15px;
      color: var(--text-secondary);
    }
    
    /* Win Rate Gauge */
    .gauge-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 150px;
    }
    
    .gauge {
      position: relative;
      width: 150px;
      height: 75px;
      overflow: hidden;
    }
    
    .gauge::before {
      content: '';
      position: absolute;
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: conic-gradient(
        var(--accent-green) 0deg,
        var(--accent-green) calc(var(--percent, 0) * 1.8deg),
        var(--bg-secondary) calc(var(--percent, 0) * 1.8deg),
        var(--bg-secondary) 180deg
      );
    }
    
    .gauge::after {
      content: '';
      position: absolute;
      top: 20px;
      left: 20px;
      width: 110px;
      height: 110px;
      background: var(--bg-card);
      border-radius: 50%;
    }
    
    .gauge-value {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 28px;
      font-weight: bold;
      z-index: 1;
    }
    
    /* Profit Card */
    .profit-display {
      text-align: center;
      padding: 30px;
    }
    
    .profit-value {
      font-size: 48px;
      font-weight: bold;
    }
    
    .profit-label {
      color: var(--text-secondary);
      margin-top: 10px;
    }
    
    /* Logs Table */
    .logs-section {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .logs-title {
      font-size: 18px;
    }
    
    .logs-actions button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 10px;
    }
    
    .btn-refresh {
      background: var(--accent);
      color: white;
    }
    
    .btn-clear {
      background: var(--accent-red);
      color: white;
    }
    
    .logs-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .logs-table th,
    .logs-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .logs-table th {
      background: var(--bg-secondary);
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-size: 12px;
    }
    
    .logs-table tbody tr:hover {
      background: rgba(255,255,255,0.02);
    }
    
    /* Status badges */
    .badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-win {
      background: rgba(34, 197, 94, 0.2);
      color: var(--accent-green);
    }
    
    .badge-loss {
      background: rgba(239, 68, 68, 0.2);
      color: var(--accent-red);
    }
    
    .badge-pending {
      background: rgba(234, 179, 8, 0.2);
      color: var(--accent-yellow);
    }
    
    .badge-placed, .badge-accepted {
      background: rgba(99, 102, 241, 0.2);
      color: var(--accent);
    }
    
    .badge-failed {
      background: rgba(239, 68, 68, 0.2);
      color: var(--accent-red);
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 50px;
      color: var(--text-secondary);
    }
    
    /* Tabs Navigation */
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      background: var(--bg-secondary);
      padding: 5px;
      border-radius: 10px;
    }
    
    .tab {
      padding: 12px 24px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .tab:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .tab.active {
      background: var(--accent);
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* User Management Styles */
    .management-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .management-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
    }
    
    .management-card h3 {
      margin-bottom: 15px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-list, .profile-list {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .user-item, .profile-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: var(--bg-secondary);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .user-item:hover, .profile-item:hover {
      background: rgba(99, 102, 241, 0.1);
    }
    
    .user-info, .profile-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .user-name, .profile-name {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .user-meta, .profile-meta {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .item-actions {
      display: flex;
      gap: 8px;
    }
    
    .item-actions button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .btn-assign {
      background: var(--accent);
      color: white;
    }
    
    .btn-main {
      background: var(--accent-green);
      color: white;
    }
    
    .btn-remove {
      background: var(--accent-red);
      color: white;
    }
    
    .btn-link {
      background: var(--bg-card);
      color: var(--accent);
      border: 1px solid var(--accent) !important;
    }
    
    /* Forms */
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .form-row input, .form-row select {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .form-row button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .btn-add {
      background: var(--accent-green);
      color: white;
    }
    
    /* Status indicators */
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }
    
    .status-dot.running {
      background: var(--accent-green);
    }
    
    .status-dot.stopped {
      background: var(--accent-red);
    }
    
    .status-dot.unassigned {
      background: var(--accent-yellow);
    }
    
    /* User Dashboard Links */
    .user-link {
      color: var(--accent);
      text-decoration: none;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .user-link:hover {
      text-decoration: underline;
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal.hidden {
      display: none;
    }
    
    .modal-content {
      background: var(--bg-card);
      padding: 25px;
      border-radius: 12px;
      min-width: 400px;
      max-width: 500px;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 20px;
      cursor: pointer;
    }
    
    .checkbox-list {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--bg-secondary);
      border-radius: 6px;
      margin-bottom: 8px;
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    
    .checkbox-item label {
      flex: 1;
      cursor: pointer;
    }
    
    .checkbox-item .main-tag {
      font-size: 10px;
      background: var(--accent-green);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
    }
    
    @media (max-width: 900px) {
      .management-section {
        grid-template-columns: 1fr;
      }
    }
    
    /* Mark Result Buttons */
    .result-buttons {
      display: flex;
      gap: 5px;
    }
    
    .result-btn {
      padding: 4px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
    }
    
    .result-btn.win {
      background: var(--accent-green);
      color: white;
    }
    
    .result-btn.loss {
      background: var(--accent-red);
      color: white;
    }
    
    @media (max-width: 768px) {
      .charts-section {
        grid-template-columns: 1fr;
      }
      
      .logs-table {
        font-size: 12px;
      }
      
      .logs-table th,
      .logs-table td {
        padding: 8px 10px;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <header>
      <div class="logo">üìä Admin Dashboard</div>
      <div style="display: flex; gap: 10px;">
        <a href="/" class="back-link">‚Üê Back to Betting</a>
        <a href="/vnc" class="back-link">üñ•Ô∏è VNC</a>
      </div>
    </header>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('stats')">üìà Statistics</button>
      <button class="tab" onclick="switchTab('users')">üë• Users</button>
      <button class="tab" onclick="switchTab('profiles')">üé∞ Profiles</button>
      <button class="tab" onclick="switchTab('logs')">üìã Bet Logs</button>
    </div>
    
    <!-- Stats Tab -->
    <div id="tab-stats" class="tab-content active">
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value blue" id="total-bets">0</div>
        <div class="stat-label">Total Bets</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="wins">0</div>
        <div class="stat-label">Wins</div>
      </div>
      <div class="stat-card">
        <div class="stat-value red" id="losses">0</div>
        <div class="stat-label">Losses</div>
      </div>
      <div class="stat-card">
        <div class="stat-value yellow" id="pending">0</div>
        <div class="stat-label">Pending</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="wagered">$0</div>
        <div class="stat-label">Total Wagered</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="won">$0</div>
        <div class="stat-label">Total Won</div>
      </div>
      <div class="stat-card">
        <div class="stat-value blue" id="prefire-attempts">0</div>
        <div class="stat-label">Prefire Attempts</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="prefire-rate">0%</div>
        <div class="stat-label">Prefire Success</div>
      </div>
    </div>
    
    <!-- Charts -->
    <div class="charts-section">
      <div class="chart-card">
        <div class="chart-title">Win Rate</div>
        <div class="gauge-container">
          <div class="gauge" id="win-gauge" style="--percent: 0;">
            <div class="gauge-value" id="win-rate">0%</div>
          </div>
        </div>
      </div>
      
      <div class="chart-card">
        <div class="chart-title">Profit/Loss</div>
        <div class="profit-display">
          <div class="profit-value" id="profit">$0.00</div>
          <div class="profit-label">Net Profit</div>
        </div>
      </div>
    </div>
    </div><!-- End Stats Tab -->
    
    <!-- Users Tab -->
    <div id="tab-users" class="tab-content">
      <div class="management-section">
        <div class="management-card">
          <h3>üë• Users</h3>
          <div class="form-row">
            <input type="text" id="new-username" placeholder="Username (lowercase)">
            <input type="text" id="new-displayname" placeholder="Display Name">
            <button class="btn-add" onclick="createUser()">+ Add User</button>
          </div>
          <div class="user-list" id="user-list">
            <!-- Users will be rendered here -->
          </div>
        </div>
        
        <div class="management-card">
          <h3>üìã Quick Assignment</h3>
          <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 13px;">
            Click on a user to assign profiles to them.
          </p>
          <div id="assignment-info">
            <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
              Select a user to manage their profiles
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Profiles Tab -->
    <div id="tab-profiles" class="tab-content">
      <!-- Quick Actions -->
      <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <button class="btn-add" onclick="startAllProfiles()" style="padding: 12px 24px;">
          üöÄ Start All Profiles
        </button>
        <button class="btn-refresh" onclick="stopAllProfiles()" style="background: var(--accent-red); padding: 12px 24px;">
          üõë Stop All Profiles
        </button>
        <button class="btn-refresh" onclick="loadAvailableProfiles()" style="padding: 12px 24px;">
          üîÑ Refresh
        </button>
      </div>
      
      <!-- Docker Controls -->
      <div class="management-card" style="margin-bottom: 20px; background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.1) 100%);">
        <h3>üê≥ Docker Container Mode</h3>
        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 13px;">
          Run profiles in isolated Docker containers with VNC access for remote viewing.
        </p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
          <button class="btn-refresh" onclick="checkDocker()" style="padding: 10px 20px;">
            üîç Check Docker
          </button>
          <button class="btn-add" onclick="buildDockerImage()" style="padding: 10px 20px;">
            üî® Build Image
          </button>
          <button class="btn-add" onclick="generateDockerCompose()" style="padding: 10px 20px;">
            üìù Generate Compose
          </button>
          <button class="btn-add" onclick="startAllDocker()" style="padding: 10px 20px; background: var(--accent-green);">
            üê≥ Start All Docker
          </button>
          <button class="btn-refresh" onclick="stopAllDocker()" style="padding: 10px 20px; background: var(--accent-red);">
            üõë Stop All Docker
          </button>
        </div>
        <div id="docker-status" style="padding: 10px; background: var(--bg-secondary); border-radius: 8px; font-size: 13px; color: var(--text-secondary);">
          Click "Check Docker" to verify Docker availability
        </div>
        
        <!-- Docker Containers List -->
        <div id="docker-containers" style="margin-top: 15px;">
          <!-- Will be populated by JS -->
        </div>
      </div>
      
      <!-- Create New Profile -->
      <div class="management-card" style="margin-bottom: 20px; background: linear-gradient(135deg, var(--bg-card) 0%, rgba(34, 197, 94, 0.1) 100%);">
        <h3>‚ûï Create New Profile</h3>
        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 13px;">
          Add a new account profile with proxy and location settings. Browser data will be created automatically.
        </p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Profile Name *</label>
            <input type="text" id="new-profile-name" placeholder="e.g., John Doe" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Account Number (Phone)</label>
            <input type="text" id="new-profile-account" placeholder="e.g., +1234567890" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Proxy</label>
            <input type="text" id="new-profile-proxy" placeholder="user:pass@host:port" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Latitude</label>
            <input type="number" id="new-profile-latitude" placeholder="40.7128" step="0.0001" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Longitude</label>
            <input type="number" id="new-profile-longitude" placeholder="-74.0060" step="0.0001" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Accuracy (meters)</label>
            <input type="number" id="new-profile-accuracy" placeholder="100" value="100" step="1" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 12px; color: var(--text-secondary);">Multiplier</label>
            <input type="number" id="new-profile-multiplier" placeholder="1.0" value="1.0" step="0.1" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-secondary); color: var(--text-primary);">
          </div>
        </div>
        <button class="btn-add" onclick="createProfile()" style="width: 100%; padding: 12px;">
          ‚ûï Create Profile
        </button>
        <div id="create-profile-status" style="margin-top: 10px; padding: 10px; border-radius: 6px; display: none; font-size: 13px;"></div>
      </div>
      
      <!-- Start User Profiles -->
      <div class="management-card" style="margin-bottom: 20px;">
        <h3>üë§ Start Profiles by User</h3>
        <div class="form-row">
          <select id="user-select-profiles" style="flex: 2;">
            <option value="">Select a user...</option>
          </select>
          <button class="btn-add" onclick="startUserProfiles()">üöÄ Start User's Profiles</button>
        </div>
      </div>
      
      <div class="management-section">
        <!-- Available Profiles -->
        <div class="management-card">
          <h3>üìÅ Available Profiles</h3>
          <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 13px;">
            Profiles found in the <code>profiles/</code> folder. Click to start.
          </p>
          <div class="profile-list" id="available-profiles">
            <!-- Available profiles will be rendered here -->
          </div>
        </div>
        
        <!-- Running Profiles -->
        <div class="management-card">
          <h3>üü¢ Running Profiles</h3>
          <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 13px;">
            Currently active browser profiles. Click to stop.
          </p>
          <div class="profile-list" id="running-profiles">
            <!-- Running profiles will be rendered here -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- Logs Tab -->
    <div id="tab-logs" class="tab-content">
    <!-- Bet Logs -->
    <div class="logs-section">
      <div class="logs-header">
        <h2 class="logs-title">üìã Bet History</h2>
        <div class="logs-actions">
          <button class="btn-refresh" onclick="loadData()">üîÑ Refresh</button>
          <button class="btn-clear" onclick="clearLogs()">üóëÔ∏è Clear All</button>
        </div>
      </div>
      
      <table class="logs-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Type</th>
            <th>Selection</th>
            <th>Odds</th>
            <th>Wager</th>
            <th>Coin</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="logs-body">
          <tr>
            <td colspan="8" class="empty-state">Loading...</td>
          </tr>
        </tbody>
      </table>
    </div>
    </div><!-- End Logs Tab -->
  </div>
  
  <!-- Assignment Modal -->
  <div id="assign-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">Assign Profiles to <span id="modal-username"></span></span>
        <button class="modal-close" onclick="closeModal()">√ó</button>
      </div>
      <div class="checkbox-list" id="modal-profiles">
        <!-- Profile checkboxes will be rendered here -->
      </div>
      <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button class="btn-add" style="flex: 1;" onclick="saveAssignments()">üíæ Save Assignments</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = window.location.origin;
    
    // State
    let allUsers = [];
    let allProfiles = [];
    let selectedUser = null;
    
    // =============================================
    // TAB SWITCHING
    // =============================================
    
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`tab-${tabName}`).classList.add('active');
      
      // Load data for specific tabs
      if (tabName === 'users') loadUsers();
      if (tabName === 'profiles') {
        loadUsers(); // For user select dropdown
        loadAvailableProfiles();
      }
    }
    
    // =============================================
    // USER MANAGEMENT
    // =============================================
    
    async function loadUsers() {
      try {
        const response = await fetch(`${API_URL}/api/admin/users`);
        allUsers = await response.json();
        renderUsers();
      } catch (e) {
        console.error('Error loading users:', e);
      }
    }
    
    function renderUsers() {
      const container = document.getElementById('user-list');
      
      if (allUsers.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--text-secondary);">No users yet</p>';
        return;
      }
      
      container.innerHTML = allUsers.map(user => `
        <div class="user-item">
          <div class="user-info">
            <span class="user-name">${user.displayName} ${user.role === 'admin' ? 'üëë' : ''}</span>
            <span class="user-meta">
              @${user.username} ¬∑ ${user.assignedProfiles?.length || 0} profiles
              ${user.mainProfile ? `¬∑ Main: ${user.mainProfile}` : ''}
            </span>
            <a href="/user/${user.username}" target="_blank" class="user-link">
              üîó Open Dashboard
            </a>
          </div>
          <div class="item-actions">
            <button class="btn-assign" onclick="openAssignModal('${user.username}')">‚öôÔ∏è Manage</button>
            ${user.username !== 'admin' ? `
              <button class="btn-remove" onclick="deleteUser('${user.username}')">üóëÔ∏è</button>
            ` : ''}
          </div>
        </div>
      `).join('');
    }
    
    async function createUser() {
      const username = document.getElementById('new-username').value.trim().toLowerCase();
      const displayName = document.getElementById('new-displayname').value.trim();
      
      if (!username) {
        alert('Please enter a username');
        return;
      }
      
      try {
        const response = await fetch(`${API_URL}/api/admin/users`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, displayName: displayName || username })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          document.getElementById('new-username').value = '';
          document.getElementById('new-displayname').value = '';
          loadUsers();
          alert(`‚úÖ User "${username}" created!\\n\\nDashboard URL: ${window.location.origin}/user/${username}`);
        } else {
          alert('Error: ' + result.error);
        }
      } catch (e) {
        console.error('Error creating user:', e);
        alert('Error creating user');
      }
    }
    
    async function deleteUser(username) {
      if (!confirm(`Delete user "${username}"? This will unassign all their profiles.`)) {
        return;
      }
      
      try {
        await fetch(`${API_URL}/api/admin/users/${username}`, { method: 'DELETE' });
        loadUsers();
      } catch (e) {
        console.error('Error deleting user:', e);
      }
    }
    
    // =============================================
    // PROFILE MANAGEMENT & CONTROL
    // =============================================
    
    let availableProfiles = [];
    
    async function loadProfiles() {
      try {
        const response = await fetch(`${API_URL}/api/admin/profiles`);
        allProfiles = await response.json();
        renderRunningProfiles();
        
        // Also update user select dropdown
        updateUserSelect();
      } catch (e) {
        console.error('Error loading profiles:', e);
      }
    }
    
    async function loadAvailableProfiles() {
      try {
        const response = await fetch(`${API_URL}/api/admin/available-profiles`);
        availableProfiles = await response.json();
        renderAvailableProfiles();
        renderRunningProfiles();
        updateUserSelect();
      } catch (e) {
        console.error('Error loading available profiles:', e);
      }
    }
    
    function updateUserSelect() {
      const select = document.getElementById('user-select-profiles');
      if (!select) return;
      
      select.innerHTML = '<option value="">Select a user...</option>' + 
        allUsers.map(user => `<option value="${user.username}">${user.displayName} (${user.assignedProfiles?.length || 0} profiles)</option>`).join('');
    }
    
    function renderAvailableProfiles() {
      const container = document.getElementById('available-profiles');
      if (!container) return;
      
      const notRunning = availableProfiles.filter(p => !p.isRunning);
      
      if (notRunning.length === 0) {
        container.innerHTML = `
          <p style="text-align: center; padding: 30px; color: var(--text-secondary);">
            All profiles are running! üéâ
          </p>
        `;
        return;
      }
      
      container.innerHTML = notRunning.map(profile => `
        <div class="profile-item">
          <div class="profile-info">
            <span class="profile-name">
              <span class="status-dot stopped"></span>
              ${profile.name}
            </span>
            <span class="profile-meta">
              üìÅ ${profile.directory}
              ${profile.isLiveEvent ? ' ¬∑ üì° Live Event' : ' ¬∑ üí∞ Betting'}
              ${profile.hasProxy ? ' ¬∑ üåê Proxy' : ''}
            </span>
          </div>
          <div class="item-actions">
            <button class="btn-add" onclick="startProfile('${profile.directory}')" style="padding: 6px 12px;">
              üöÄ Start
            </button>
          </div>
        </div>
      `).join('');
    }
    
    function renderRunningProfiles() {
      const container = document.getElementById('running-profiles');
      if (!container) return;
      
      const running = availableProfiles.filter(p => p.isRunning);
      
      if (running.length === 0) {
        container.innerHTML = `
          <p style="text-align: center; padding: 30px; color: var(--text-secondary);">
            No profiles running.<br>Start some from the left panel.
          </p>
        `;
        return;
      }
      
      container.innerHTML = running.map(profile => `
        <div class="profile-item">
          <div class="profile-info">
            <span class="profile-name">
              <span class="status-dot running"></span>
              ${profile.name}
            </span>
            <span class="profile-meta">
              üìÅ ${profile.directory}
              ${profile.isLiveEvent ? ' ¬∑ üì° Live Event' : ' ¬∑ üí∞ Betting'}
            </span>
          </div>
          <div class="item-actions">
            <button class="btn-remove" onclick="stopProfile('${profile.name}')" style="padding: 6px 12px;">
              üõë Stop
            </button>
          </div>
        </div>
      `).join('');
    }
    
    // =============================================
    // PROFILE CREATION
    // =============================================
    
    async function createProfile() {
      const statusDiv = document.getElementById('create-profile-status');
      statusDiv.style.display = 'none';
      
      const name = document.getElementById('new-profile-name').value.trim();
      const account = document.getElementById('new-profile-account').value.trim();
      const proxy = document.getElementById('new-profile-proxy').value.trim();
      const latitude = document.getElementById('new-profile-latitude').value;
      const longitude = document.getElementById('new-profile-longitude').value;
      const accuracy = document.getElementById('new-profile-accuracy').value || '100';
      const multiplier = document.getElementById('new-profile-multiplier').value || '1.0';
      
      if (!name) {
        statusDiv.style.display = 'block';
        statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
        statusDiv.style.border = '1px solid var(--accent-red)';
        statusDiv.style.color = 'var(--accent-red)';
        statusDiv.textContent = '‚ùå Profile name is required';
        return;
      }
      
      try {
        statusDiv.style.display = 'block';
        statusDiv.style.background = 'rgba(99, 102, 241, 0.2)';
        statusDiv.style.border = '1px solid var(--accent)';
        statusDiv.style.color = 'var(--accent)';
        statusDiv.textContent = '‚è≥ Creating profile...';
        
        const response = await fetch(`${API_URL}/api/admin/create-profile`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name,
            account_number: account,
            proxy,
            latitude: latitude ? parseFloat(latitude) : 0,
            longitude: longitude ? parseFloat(longitude) : 0,
            accuracy: accuracy ? parseFloat(accuracy) : 100,
            multiplier: multiplier ? parseFloat(multiplier) : 1.0
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          statusDiv.style.background = 'rgba(34, 197, 94, 0.2)';
          statusDiv.style.border = '1px solid var(--accent-green)';
          statusDiv.style.color = 'var(--accent-green)';
          statusDiv.textContent = `‚úÖ ${result.message}`;
          
          // Clear form
          document.getElementById('new-profile-name').value = '';
          document.getElementById('new-profile-account').value = '';
          document.getElementById('new-profile-proxy').value = '';
          document.getElementById('new-profile-latitude').value = '';
          document.getElementById('new-profile-longitude').value = '';
          document.getElementById('new-profile-accuracy').value = '100';
          document.getElementById('new-profile-multiplier').value = '1.0';
          
          // Reload profiles list
          setTimeout(() => {
            loadAvailableProfiles();
            statusDiv.style.display = 'none';
          }, 2000);
        } else {
          statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
          statusDiv.style.border = '1px solid var(--accent-red)';
          statusDiv.style.color = 'var(--accent-red)';
          statusDiv.textContent = `‚ùå ${result.error || 'Failed to create profile'}`;
        }
      } catch (e) {
        statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
        statusDiv.style.border = '1px solid var(--accent-red)';
        statusDiv.style.color = 'var(--accent-red)';
        statusDiv.textContent = `‚ùå Error: ${e.message}`;
      }
    }
    
    async function startProfile(directory) {
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = '‚è≥ Starting...';
        
        const response = await fetch(`${API_URL}/api/admin/start-profile`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ profileDirectory: directory })
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert(`‚úÖ ${result.message}`);
          loadAvailableProfiles();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function stopProfile(profileName) {
      if (!confirm(`Stop profile "${profileName}"?`)) return;
      
      try {
        const response = await fetch(`${API_URL}/api/admin/stop-profile`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ profileName })
        });
        
        const result = await response.json();
        
        if (result.success) {
          loadAvailableProfiles();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function startAllProfiles() {
      if (!confirm('Start ALL profiles? This may take a while.')) return;
      
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = '‚è≥ Starting all...';
        
        const response = await fetch(`${API_URL}/api/admin/start-all-profiles`, {
          method: 'POST'
        });
        
        const result = await response.json();
        
        btn.disabled = false;
        btn.textContent = 'üöÄ Start All Profiles';
        
        if (result.success) {
          alert(`‚úÖ Started ${result.startedCount} profiles\\n‚è© Already running: ${result.alreadyRunningCount}`);
          loadAvailableProfiles();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function stopAllProfiles() {
      if (!confirm('Stop ALL running profiles?')) return;
      
      try {
        const response = await fetch(`${API_URL}/api/admin/stop-all-profiles`, {
          method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert(`‚úÖ Stopped ${result.stoppedCount} profiles`);
          loadAvailableProfiles();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function startUserProfiles() {
      const select = document.getElementById('user-select-profiles');
      const username = select.value;
      
      if (!username) {
        alert('Please select a user');
        return;
      }
      
      try {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = '‚è≥ Starting...';
        
        const response = await fetch(`${API_URL}/api/admin/start-user-profiles`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        
        const result = await response.json();
        
        btn.disabled = false;
        btn.textContent = "üöÄ Start User's Profiles";
        
        if (result.success) {
          alert(`‚úÖ Started ${result.startedCount}/${result.totalCount} profiles for ${username}`);
          loadAvailableProfiles();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    // =============================================
    // DOCKER MANAGEMENT
    // =============================================
    
    async function checkDocker() {
      const statusEl = document.getElementById('docker-status');
      statusEl.textContent = 'üîç Checking Docker...';
      
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/status`);
        const result = await response.json();
        
        if (result.available) {
          statusEl.innerHTML = '‚úÖ <strong>Docker is available!</strong> You can run profiles in containers.';
          statusEl.style.background = 'rgba(34, 197, 94, 0.2)';
          loadDockerContainers();
        } else {
          statusEl.innerHTML = '‚ùå <strong>Docker not available.</strong> Install Docker Desktop to use container mode.';
          statusEl.style.background = 'rgba(239, 68, 68, 0.2)';
        }
      } catch (e) {
        statusEl.innerHTML = `‚ùå Error: ${e.message}`;
        statusEl.style.background = 'rgba(239, 68, 68, 0.2)';
      }
    }
    
    async function buildDockerImage() {
      const statusEl = document.getElementById('docker-status');
      statusEl.textContent = 'üî® Building Docker image... This may take a few minutes.';
      
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/build`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
          statusEl.innerHTML = '‚úÖ Docker image built successfully!';
          statusEl.style.background = 'rgba(34, 197, 94, 0.2)';
        } else {
          statusEl.innerHTML = `‚ùå Build failed: ${result.error}`;
          statusEl.style.background = 'rgba(239, 68, 68, 0.2)';
        }
      } catch (e) {
        statusEl.innerHTML = `‚ùå Error: ${e.message}`;
      }
    }
    
    async function generateDockerCompose() {
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/generate-compose`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
          alert(`‚úÖ Generated docker-compose.generated.yml with ${result.profileCount} profiles`);
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function startAllDocker() {
      const statusEl = document.getElementById('docker-status');
      statusEl.textContent = 'üê≥ Starting all Docker containers...';
      
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/start-all`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
          statusEl.innerHTML = '‚úÖ All containers started!';
          loadDockerContainers();
        } else {
          statusEl.innerHTML = `‚ùå Error: ${result.error}`;
        }
      } catch (e) {
        statusEl.innerHTML = `‚ùå Error: ${e.message}`;
      }
    }
    
    async function stopAllDocker() {
      if (!confirm('Stop all Docker containers?')) return;
      
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/stop-all`, { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
          alert('‚úÖ All Docker containers stopped');
          loadDockerContainers();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function loadDockerContainers() {
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/containers`);
        const containers = await response.json();
        
        const container = document.getElementById('docker-containers');
        
        if (containers.length === 0) {
          container.innerHTML = '<p style="color: var(--text-secondary); font-size: 13px;">No Docker containers created yet.</p>';
          return;
        }
        
        container.innerHTML = `
          <h4 style="margin-bottom: 10px; font-size: 14px;">üì¶ Docker Containers</h4>
          ${containers.map(c => `
            <div class="profile-item" style="margin-bottom: 8px;">
              <div class="profile-info">
                <span class="profile-name">
                  <span class="status-dot ${c.isRunning ? 'running' : 'stopped'}"></span>
                  ${c.profileName}
                </span>
                <span class="profile-meta">
                  VNC: ${c.vncPort} ¬∑ noVNC: ${c.noVncPort}
                  ${c.isRunning ? ' ¬∑ üü¢ Running' : ' ¬∑ üî¥ Stopped'}
                </span>
              </div>
              <div class="item-actions">
                ${c.isRunning ? `
                  <a href="http://localhost:${c.noVncPort}/vnc.html" target="_blank" class="btn-link" style="padding: 4px 8px; font-size: 11px;">
                    üñ•Ô∏è View VNC
                  </a>
                ` : ''}
                <button class="btn-remove" onclick="stopDockerContainer('${c.profileName}')" style="padding: 4px 8px; font-size: 11px;">
                  üõë Stop
                </button>
              </div>
            </div>
          `).join('')}
        `;
      } catch (e) {
        console.error('Error loading Docker containers:', e);
      }
    }
    
    async function createDockerContainer(profileName, profileDirectory) {
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/create-container`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ profileName, profileDirectory })
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert(`‚úÖ Container created!\\n\\nnoVNC: ${result.noVncUrl}`);
          loadDockerContainers();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    async function stopDockerContainer(profileName) {
      try {
        const response = await fetch(`${API_URL}/api/admin/docker/stop-container`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ profileName })
        });
        
        const result = await response.json();
        
        if (result.success) {
          loadDockerContainers();
        } else {
          alert(`‚ùå Error: ${result.error}`);
        }
      } catch (e) {
        alert(`‚ùå Error: ${e.message}`);
      }
    }
    
    // Legacy renderProfiles for backwards compatibility
    function renderProfiles() {
      const container = document.getElementById('profile-list');
      if (!container) return;
      
      if (allProfiles.length === 0) {
        container.innerHTML = `
          <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
            No browser profiles registered.<br><br>
            Start browser profiles to see them here.
          </p>
        `;
        return;
      }
      
      container.innerHTML = allProfiles.map(profile => `
        <div class="profile-item">
          <div class="profile-info">
            <span class="profile-name">
              <span class="status-dot ${profile.isRunning ? 'running' : 'stopped'}"></span>
              ${profile.name}
            </span>
            <span class="profile-meta">
              ${profile.isRunning ? 'üü¢ Running' : 'üî¥ Stopped'}
              ${profile.assignedTo ? ` ¬∑ Assigned to: ${profile.assignedTo}` : ' ¬∑ ‚ö†Ô∏è Unassigned'}
            </span>
          </div>
          <div class="item-actions">
            ${profile.assignedTo ? `
              <button class="btn-link" onclick="openUserDashboard('${profile.assignedTo}')">üë§ ${profile.assignedTo}</button>
            ` : `
              <span style="color: var(--accent-yellow); font-size: 12px;">Not assigned to any user</span>
            `}
          </div>
        </div>
      `).join('');
    }
    
    function openUserDashboard(username) {
      window.open(`/user/${username}`, '_blank');
    }
    
    // =============================================
    // ASSIGNMENT MODAL
    // =============================================
    
    async function openAssignModal(username) {
      selectedUser = username;
      document.getElementById('modal-username').textContent = username;
      
      // Load profiles if not loaded
      if (allProfiles.length === 0) {
        await loadProfiles();
      }
      
      // Get user's current assignments
      const user = allUsers.find(u => u.username === username);
      const assignedProfiles = user?.assignedProfiles || [];
      const mainProfile = user?.mainProfile;
      
      // Render profile checkboxes
      const container = document.getElementById('modal-profiles');
      
      container.innerHTML = allProfiles.map(profile => `
        <div class="checkbox-item">
          <input type="checkbox" id="profile-${profile.name}" value="${profile.name}"
            ${assignedProfiles.includes(profile.name) ? 'checked' : ''}>
          <label for="profile-${profile.name}">
            <span class="status-dot ${profile.isRunning ? 'running' : 'stopped'}"></span>
            ${profile.name}
          </label>
          ${profile.name === mainProfile ? '<span class="main-tag">MAIN</span>' : ''}
          <button class="btn-main" style="padding: 4px 8px; font-size: 10px;" 
            onclick="setMainProfile('${username}', '${profile.name}')">
            Set Main
          </button>
        </div>
      `).join('');
      
      document.getElementById('assign-modal').classList.remove('hidden');
    }
    
    function closeModal() {
      document.getElementById('assign-modal').classList.add('hidden');
      selectedUser = null;
    }
    
    async function saveAssignments() {
      if (!selectedUser) return;
      
      // Get selected profiles
      const checkboxes = document.querySelectorAll('#modal-profiles input[type="checkbox"]');
      const selectedProfiles = [];
      checkboxes.forEach(cb => {
        if (cb.checked) {
          selectedProfiles.push(cb.value);
        }
      });
      
      try {
        // First, unassign all current profiles
        const user = allUsers.find(u => u.username === selectedUser);
        const currentProfiles = user?.assignedProfiles || [];
        
        for (const profile of currentProfiles) {
          if (!selectedProfiles.includes(profile)) {
            await fetch(`${API_URL}/api/admin/unassign-profile`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username: selectedUser, profileName: profile })
            });
          }
        }
        
        // Then assign new profiles
        for (const profile of selectedProfiles) {
          if (!currentProfiles.includes(profile)) {
            await fetch(`${API_URL}/api/admin/assign-profile`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username: selectedUser, profileName: profile })
            });
          }
        }
        
        closeModal();
        loadUsers();
        loadProfiles();
        alert('‚úÖ Assignments saved!');
      } catch (e) {
        console.error('Error saving assignments:', e);
        alert('Error saving assignments');
      }
    }
    
    async function setMainProfile(username, profileName) {
      try {
        await fetch(`${API_URL}/api/admin/set-main-profile`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, profileName })
        });
        
        // Refresh modal
        await loadUsers();
        openAssignModal(username);
      } catch (e) {
        console.error('Error setting main profile:', e);
      }
    }
    
    // =============================================
    // STATS & LOGS
    // =============================================
    
    async function loadData() {
      try {
        // Load stats
        const statsRes = await fetch(`${API_URL}/api/admin/stats`);
        const stats = await statsRes.json();
        
        document.getElementById('total-bets').textContent = stats.totalBets;
        document.getElementById('wins').textContent = stats.wins;
        document.getElementById('losses').textContent = stats.losses;
        document.getElementById('pending').textContent = stats.pending;
        document.getElementById('wagered').textContent = '$' + stats.totalWagered.toFixed(2);
        document.getElementById('won').textContent = '$' + stats.totalWon.toFixed(2);
        document.getElementById('prefire-attempts').textContent = stats.prefireAttempts;
        document.getElementById('prefire-rate').textContent = stats.prefireRate;
        document.getElementById('win-rate').textContent = stats.winRate;
        
        // Profit
        const profit = stats.profit;
        const profitEl = document.getElementById('profit');
        profitEl.textContent = (profit >= 0 ? '+' : '') + '$' + profit.toFixed(2);
        profitEl.className = 'profit-value ' + (profit >= 0 ? 'green' : 'red');
        
        // Win gauge
        const winPercent = parseFloat(stats.winRate) || 0;
        document.getElementById('win-gauge').style.setProperty('--percent', winPercent);
        
        // Load logs
        const logsRes = await fetch(`${API_URL}/api/admin/logs?limit=50`);
        const logs = await logsRes.json();
        
        renderLogs(logs);
      } catch (e) {
        console.error('Error loading data:', e);
      }
    }
    
    function renderLogs(logs) {
      const tbody = document.getElementById('logs-body');
      
      if (logs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No bets yet</td></tr>';
        return;
      }
      
      tbody.innerHTML = logs.map(log => {
        const time = new Date(log.timestamp).toLocaleString();
        const resultClass = getResultClass(log.result);
        const showActions = log.result === 'accepted' || log.result === 'placed';
        
        return `
          <tr>
            <td>${time}</td>
            <td>${log.type}</td>
            <td>${log.selection}</td>
            <td>${log.odds > 0 ? '+' : ''}${log.odds}</td>
            <td>$${(log.wager || 0).toFixed(2)}</td>
            <td>${log.coinType === 'cash' ? 'üíµ' : 'ü™ô'}</td>
            <td><span class="badge ${resultClass}">${log.result}</span></td>
            <td>
              ${showActions ? `
                <div class="result-buttons">
                  <button class="result-btn win" onclick="markResult('${log.id}', 'win')">Win</button>
                  <button class="result-btn loss" onclick="markResult('${log.id}', 'loss')">Loss</button>
                </div>
              ` : '-'}
            </td>
          </tr>
        `;
      }).join('');
    }
    
    function getResultClass(result) {
      switch (result) {
        case 'win': return 'badge-win';
        case 'loss': return 'badge-loss';
        case 'pending':
        case 'placed':
        case 'accepted': return 'badge-placed';
        case 'failed':
        case 'failed_click':
        case 'odds_changed': return 'badge-failed';
        default: return '';
      }
    }
    
    async function markResult(betId, result) {
      try {
        await fetch(`${API_URL}/api/admin/result`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ betId, result, payout: 0 })
        });
        loadData();
      } catch (e) {
        console.error('Error marking result:', e);
      }
    }
    
    async function clearLogs() {
      if (!confirm('Are you sure you want to clear all logs?')) return;
      
      try {
        await fetch(`${API_URL}/api/admin/clear`, { method: 'POST' });
        loadData();
      } catch (e) {
        console.error('Error clearing logs:', e);
      }
    }
    
    // Auto refresh every 10 seconds
    setInterval(loadData, 10000);
    
    // Initial load
    loadData();
  </script>
</body>
</html>

