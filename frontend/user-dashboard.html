<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fliff Live Betting</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1 class="logo">‚ö° FLIFF LIVE</h1>
      
      <!-- Controls -->
      <div class="header-controls">
        <!-- Wager Amount -->
        <div class="wager-select">
          <label>Wager:</label>
          <select id="wager-amount" onchange="handleWagerChange(this.value)">
            <option value="0.20">$0.20</option>
            <option value="0.50">$0.50</option>
            <option value="1">$1</option>
            <option value="2">$2</option>
            <option value="5">$5</option>
            <option value="10" selected>$10</option>
            <option value="25">$25</option>
            <option value="50">$50</option>
            <option value="100">$100</option>
            <option value="200">$200</option>
            <option value="250">$250</option>
            <option value="500">$500</option>
            <option value="custom">Custom</option>
          </select>
          <input type="number" id="custom-wager" class="custom-wager-input" placeholder="Enter amount" min="0.01" step="0.01" style="display: none; margin-left: 10px; width: 120px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;" onchange="setCustomWager(this.value)" onblur="setCustomWager(this.value)">
        </div>
        <!-- Filter Unavailable Markets -->
        <div class="wager-select" style="margin-left: 15px;">
          <label>
            <input type="checkbox" id="hide-unavailable" onchange="toggleUnavailableFilter()">
            Hide Unavailable
          </label>
        </div>
      </div>
      
      <div class="status-bar">
        <span class="status-indicator" id="status">
          <span class="dot"></span>
          <span id="status-text">Connecting...</span>
        </span>
        <span class="stat">üéÆ <span id="games-count">0</span></span>
        <div class="game-status-filter" style="margin-right: 15px;">
          <label for="game-status-filter-select" style="margin-right: 6px; font-size: 0.85rem;">Show:</label>
          <select id="game-status-filter-select" onchange="handleGameStatusFilterChange(this.value)">
            <option value="live" selected>üî¥ Live Only</option>
            <option value="all">üìã All Games</option>
          </select>
        </div>
        <div class="league-filter">
          <label for="league-filter-select" style="margin-right: 6px; font-size: 0.85rem;">League:</label>
          <select id="league-filter-select" onchange="handleLeagueFilterChange(this.value)">
            <option value="all">All</option>
          </select>
        </div>
        <!-- User Info Badge -->
        <span class="user-badge" id="user-badge" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">
          üë§ <span id="user-display-name">Loading...</span>
        </span>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Prefire Status -->
      <div id="prefire-status" class="prefire-status hidden">
        <div class="prefire-indicator">
          <span class="spinner"></span>
          <span id="prefire-text">Prefire in progress...</span>
        </div>
      </div>
      
      <!-- Games List -->
      <section class="games-section">
        <h2 class="section-title">üî¥ Live Games</h2>
        <div id="games-list" class="games-list">
          <div class="loading">Loading live games...</div>
        </div>
      </section>

      <!-- Loading Overlay for Game Navigation -->
      <div id="game-loading-overlay" class="game-loading-overlay hidden">
        <div class="loading-content">
          <div class="loading-timer-container">
            <div class="loading-timer-circle">
              <svg viewBox="0 0 100 100">
                <circle class="timer-bg" cx="50" cy="50" r="45"/>
                <circle class="timer-progress" id="timer-circle" cx="50" cy="50" r="45"/>
              </svg>
              <span class="timer-text" id="timer-text">15</span>
            </div>
          </div>
          <h3 id="loading-title">Loading Game...</h3>
          <p id="loading-subtitle">Navigating main profile browser</p>
          <div class="loading-progress-container">
            <div class="loading-progress-bar" id="loading-progress"></div>
          </div>
          <p class="loading-hint">Fetching market data from main profile...</p>
        </div>
      </div>

      <!-- Selected Game Panel -->
      <section id="game-panel" class="game-panel hidden">
        <div class="panel-header">
          <button class="back-btn" onclick="closeGamePanel()">‚Üê Back</button>
          <h2 id="panel-title">Game Details</h2>
          <div class="panel-controls">
            <div class="wager-select" style="display: flex; align-items: center; gap: 8px;">
              <label for="wager-amount-inner" style="margin: 0; font-size: 0.9rem;">Wager:</label>
              <select id="wager-amount-inner" onchange="handleWagerChange(this.value)" style="min-width: 90px;">
                <option value="0.20">$0.20</option>
                <option value="0.50">$0.50</option>
                <option value="1">$1</option>
                <option value="2">$2</option>
                <option value="5">$5</option>
                <option value="10" selected>$10</option>
                <option value="25">$25</option>
                <option value="50">$50</option>
                <option value="100">$100</option>
                <option value="200">$200</option>
                <option value="250">$250</option>
                <option value="500">$500</option>
                <option value="custom">Custom</option>
              </select>
              <input type="number"
                     id="custom-wager-inner"
                     class="custom-wager-input"
                     placeholder="Enter amount"
                     min="0.01"
                     step="0.01"
                     style="display: none; width: 110px; padding: 4px 6px; border: 1px solid #ddd; border-radius: 4px;"
                     onchange="setCustomWager(this.value)"
                     onblur="setCustomWager(this.value)" />
              <span class="wager-display" style="font-size: 0.9rem;">üí∞ $<span id="current-wager">10.00</span></span>
            </div>
            <span id="coin-type-display" class="coin-type">üíµ Cash</span>
          </div>
        </div>
        
        <div class="game-score-card" id="score-card">
          <!-- Score display -->
        </div>

        <div class="odds-section">
          <h3>üî• Click any odds = AUTO PREFIRE ($0.20) ‚Üí Place Real Bet</h3>
          <div id="odds-list" class="odds-list">
            <div class="loading">Loading odds...</div>
          </div>
        </div>
      </section>
    </main>
    
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- User-Specific App Script -->
  <script>
    // =============================================
    // USER-SPECIFIC CONFIGURATION
    // Get username from URL: /user/:username
    // =============================================
    const pathParts = window.location.pathname.split('/');
    const USERNAME = pathParts[pathParts.indexOf('user') + 1];
    
    // Override API endpoints to use user-scoped versions
    window.USER_MODE = true;
    window.CURRENT_USERNAME = USERNAME;
    
    // Load user info
    async function loadUserInfo() {
      try {
        const response = await fetch(`${window.location.origin}/api/user/${USERNAME}/dashboard`);
        if (!response.ok) throw new Error('User not found');
        const data = await response.json();
        document.getElementById('user-display-name').textContent = data.user.displayName;
        document.title = `Fliff Live - ${data.user.displayName}`;
        return data;
      } catch (e) {
        console.error('Error loading user info:', e);
        document.getElementById('user-display-name').textContent = USERNAME;
      }
    }
    
    // Initialize user info before main app loads
    loadUserInfo();
  </script>
  
  <!-- Main App Script (handles user mode automatically) -->
  <script src="/app.js"></script>
  
  <script>
    // Log that user mode is active
    console.log(`üë§ User Dashboard Active: ${USERNAME}`);
    console.log(`üìç API calls will use user-scoped endpoints`);
  </script>
</body>
</html>
